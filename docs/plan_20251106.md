# RTSTP TO YOLO

## 基本思路

````
RTSP串流 → YOLO辨識 → 辨識結果 → 寫入資料庫
````

### 這個架構的優點

✅ 架構清晰,易於維護
✅ 解耦合:辨識系統獨立於 NX(network optix)
✅ 彈性高:可以自由選擇資料庫和處理邏輯
✅ 可擴展:容易增加多個攝影機或分析功能

### 需要考慮和調整的重點

- 不需要處理每一幀,會造成資源浪費和資料庫負擔:
- 資料庫設計建議

````
-- 偵測記錄表
CREATE TABLE detections (
    id SERIAL PRIMARY KEY,
    camera_id VARCHAR(50) NOT NULL,
    camera_name VARCHAR(100),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    object_class VARCHAR(50),
    confidence FLOAT,
    bbox_x1 INT,
    bbox_y1 INT,
    bbox_x2 INT,
    bbox_y2 INT,
    snapshot_path VARCHAR(255),  -- 儲存截圖路徑(可選)
    INDEX idx_camera_time (camera_id, timestamp),
    INDEX idx_class (object_class)
);

-- 攝影機資訊表(可選)
CREATE TABLE cameras (
    camera_id VARCHAR(50) PRIMARY KEY,
    camera_name VARCHAR(100),
    rtsp_url VARCHAR(255),
    location VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE
);

-- 統計彙總表(用於快速查詢)
CREATE TABLE detection_summary (
    id SERIAL PRIMARY KEY,
    camera_id VARCHAR(50),
    date DATE,
    hour INT,
    object_class VARCHAR(50),
    count INT,
    PRIMARY KEY (camera_id, date, hour, object_class)
);

````

### 資料過濾策略

- 不是所有偵測都要寫入資料庫
- 過濾低信心度或不重要的偵測

## YOLO 的限制

### 標準的 YOLO 模型(如 YOLOv8)預訓練在 COCO 資料集上,只能辨識 80 個類別

````
# COCO 資料集的類別
['person', 'bicycle', 'car', 'motorcycle', 'airplane', 'bus', 'train', 
 'truck', 'boat', 'traffic light', 'fire hydrant', 'stop sign', 
 'parking meter', 'bench', 'bird', 'cat', 'dog', 'horse', 'sheep', 
 'cow', 'elephant', 'bear', 'zebra', 'giraffe', 'backpack', 'umbrella', 
 'handbag', 'tie', 'suitcase', 'frisbee', 'skis', 'snowboard', 
 'sports ball', 'kite', 'baseball bat', ...]
````

### 無法做到的細部辨識

    ❌ 區分不同車款(Toyota vs BMW)
    ❌ 辨識人臉身份(張三 vs 李四)
    ❌ 辨識車牌號碼
    ❌ 辨識特定制服或品牌
    ❌ 辨識特定商品型號

### 解決方案 兩階段辨識架構

- 先用 YOLO 做大類別偵測,再用專門的模型做細部辨識:

````
YOLO 大類別偵測 (基礎層)
    ↓
細部辨識引擎 (可插拔模組)
    ├── 車牌辨識模組
    ├── 人臉辨識模組
    ├── 商品辨識模組
    └── 自訂模組...
    ↓
統一結果處理 & 資料庫
````

### 系統特色 ✨ 核心優勢

    - 可插拔架構 - 輕鬆新增/移除辨識模組
    - 零標記方案 - 內建車牌辨識模組
    - 彈性擴展 - 支援任何自訂辨識需求
    - 統一介面 - 所有模組共用相同結構