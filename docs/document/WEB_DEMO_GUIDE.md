# 🌐 網頁展示模式使用指南

## 📋 概述

為了方便 Demo 展示，系統提供了**網頁展示模式**，可以透過瀏覽器即時查看：
- **左側**：RTSP 即時影像 + YOLO 框選結果
- **右側**：車牌辨識結果（即時更新）
- **頂部**：統計資料（總偵測數、辨識成功數、成功率）

---

## 🚀 快速啟動

### 方法 1：使用批次檔（推薦）

```batch
雙擊 start_web.bat
```

或在命令列執行：
```cmd
start_web.bat
```

### 方法 2：手動啟動

```powershell
# 1. 啟動虛擬環境
venv\Scripts\activate

# 2. 安裝網頁套件
pip install flask flask-socketio python-socketio eventlet

# 3. 啟動伺服器
python web_server.py
```

---

## 🌐 開啟網頁

伺服器啟動後，在瀏覽器開啟：

```
http://localhost:5000
```

或是從其他電腦訪問（區域網路內）：

```
http://<你的IP>:5000
```

例如：`http://192.168.1.100:5000`

---

## 📺 介面說明

### 頂部統計區

```
┌─────────────┬─────────────┬─────────────┐
│ 總偵測數     │ 車牌辨識成功 │ 辨識成功率   │
│     156     │     23      │    14.7%    │
└─────────────┴─────────────┴─────────────┘
```

- **總偵測數**：YOLO 偵測到的車輛總數
- **車牌辨識成功**：成功辨識出車牌的數量
- **辨識成功率**：成功率百分比

### 左側影像區

顯示即時 RTSP 影像，包含：
- ✅ 綠色框：一般偵測到的車輛
- ✅ 黃色框：成功辨識車牌的車輛
- 🏷️ 標籤：顯示物件類型和信心度
- 🎯 車牌號碼：成功辨識時直接顯示

### 右側結果區

即時顯示辨識結果卡片：

```
┌──────────────────────────┐
│      ABC-1234            │ ← 車牌號碼（大字）
├──────────────┬───────────┤
│ 物件類型     │ car       │
│ 偵測信心度   │ 85.3%     │
│ OCR 信心度   │ 72.5%     │
│ 搜尋區域     │ bottom    │
└──────────────┴───────────┘
   ⏰ 11:30:45
```

- 只顯示**成功辨識車牌**的結果
- 最新的結果顯示在最上方
- 自動捲動，最多顯示 20 條記錄
- 漸入動畫效果

---

## 🎨 視覺效果

### 配色方案
- **主色調**：紫色漸層 (#667eea → #764ba2)
- **成功標記**：綠色 (#10b981)
- **警告標記**：紅色 (#ef4444)
- **高亮色**：黃色（影像中的車牌框）

### 動畫效果
- ✨ 新結果卡片：滑入動畫
- 🎯 即時數據：平滑更新
- 🔄 連線狀態：動態指示

---

## 🔧 技術架構

### 後端技術棧
- **Flask**：網頁框架
- **Flask-SocketIO**：WebSocket 即時通訊
- **OpenCV**：影像處理
- **YOLO v8**：物件偵測
- **EasyOCR**：車牌辨識

### 前端技術棧
- **HTML5 + CSS3**：介面設計
- **Socket.IO**：即時數據接收
- **JavaScript**：互動邏輯

### 通訊流程

```
RTSP 攝影機
    ↓
web_server.py (處理影像)
    ↓
YOLO 偵測 + OCR 辨識
    ↓
WebSocket 推送結果
    ↓
瀏覽器即時更新
```

---

## ⚙️ 設定調整

### 1. 更改伺服器埠號

編輯 `web_server.py` 最後一行：

```python
socketio.run(app, host='0.0.0.0', port=5000, debug=False)
                                        ^^^^
                                        改成其他埠號
```

### 2. 調整影像品質

編輯 `web_server.py` 中的 `generate_frames()` 函數：

```python
ret, buffer = cv2.imencode('.jpg', frame, [cv2.IMWRITE_JPEG_QUALITY, 85])
                                                                      ^^
                                                                      品質 (0-100)
```

### 3. 調整處理頻率

編輯 `web_server.py` 中的 `process_camera()` 函數：

```python
if frame_count % 60 == 0:  # 假設 30 fps，每 2 秒處理一次
                ^^
                調整這個數字
```

### 4. 限制顯示結果數量

編輯 `templates/index.html` 中的 JavaScript：

```javascript
if (cards.length > 20) {  // 最多顯示 20 條
                    ^^
                    調整數量
```

---

## 🎬 Demo 展示技巧

### 準備工作

1. ✅ 確認攝影機連線正常
2. ✅ 調整好攝影機角度（單一車道）
3. ✅ 提高 RTSP 解析度（HD 或更高）
4. ✅ 測試網路連線速度
5. ✅ 準備備用展示影片（萬一 RTSP 斷線）

### 展示流程

1. **開場**（5 分鐘）
   - 介紹系統架構
   - 展示主要功能

2. **即時展示**（10 分鐘）
   - 開啟網頁介面
   - 等待車輛經過
   - 展示辨識結果

3. **數據分析**（5 分鐘）
   - 統計資料說明
   - 成功率分析
   - 應用場景討論

### 注意事項

⚠️ **可能遇到的問題**

1. **RTSP 延遲**
   - 解決：使用有線網路
   - 解決：提高網路頻寬

2. **辨識成功率低**
   - 解決：調整攝影機角度
   - 解決：提高影像解析度
   - 解決：選擇車輛較近的位置

3. **網頁卡頓**
   - 解決：降低影像品質
   - 解決：減少處理頻率
   - 解決：使用更快的電腦

4. **瀏覽器相容性**
   - 推薦：Chrome、Edge、Firefox
   - 避免：IE（不支援 WebSocket）

---

## 📊 效能優化

### 建議配置

| 項目 | 推薦值 |
|------|--------|
| RTSP 解析度 | 1280x720 (HD) |
| 影像品質 | 85% |
| 處理頻率 | 每 2 秒 |
| GPU 加速 | 啟用 |
| 最大顯示結果 | 20 條 |

### 記憶體使用

- **正常運作**：約 1.5-2 GB
- **高負載**：約 2.5-3 GB
- **建議配置**：8 GB RAM

### CPU/GPU 使用

- **YOLO 偵測**：主要使用 GPU
- **OCR 辨識**：可選 GPU 加速
- **影像編碼**：使用 CPU

---

## 🐛 故障排除

### 問題 1：無法連接伺服器

**症狀：** 瀏覽器顯示「無法連接」

**解決：**
```powershell
# 檢查伺服器是否啟動
netstat -ano | findstr :5000

# 檢查防火牆設定
# Windows 設定 → 防火牆 → 允許應用程式通過防火牆
```

### 問題 2：影像不顯示

**症狀：** 網頁顯示但影像區域是黑色

**解決：**
```powershell
# 檢查 RTSP 連線
python -c "import cv2; cap = cv2.VideoCapture('rtsp://...'); print(cap.isOpened())"

# 查看日誌
type logs\system.log | findstr "RTSP|連接"
```

### 問題 3：WebSocket 連線失敗

**症狀：** 連線狀態顯示「已斷開」

**解決：**
```powershell
# 重新安裝 WebSocket 套件
pip install --upgrade flask-socketio python-socketio eventlet

# 檢查瀏覽器 Console 是否有錯誤訊息
```

---

## 📱 多裝置訪問

### 同一網路內訪問

1. **查詢本機 IP**
   ```cmd
   ipconfig | findstr IPv4
   ```

2. **開啟防火牆埠號**
   - Windows 設定 → 防火牆
   - 進階設定 → 輸入規則
   - 新增規則：TCP 埠 5000

3. **從其他裝置訪問**
   ```
   http://<電腦IP>:5000
   ```

### 投影展示

- 💡 **全螢幕模式**：F11
- 💡 **縮放調整**：Ctrl + 滑鼠滾輪
- 💡 **雙螢幕**：延伸桌面到投影機

---

## 🎯 進階功能（待實作）

### 可擴展功能

- [ ] 歷史記錄查詢
- [ ] 車牌資料匯出
- [ ] 多攝影機支援
- [ ] 警報通知
- [ ] 統計圖表
- [ ] 使用者認證

---

**更新日期：** 2025-11-06  
**狀態：** ✅ 已完成基礎功能
